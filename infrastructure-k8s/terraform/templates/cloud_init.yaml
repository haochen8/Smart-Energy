#cloud-config
package_update: true
package_upgrade: false

# Inject the SSH key provided by OpenStack keypair
ssh_authorized_keys:
  - ${ssh_authorized_key}

packages:
  - python3
  - python3-pip

# Minimal setup - let Ansible handle everything else
runcmd:
  # Install Ansible
  - python3 -m pip install --user ansible --break-system-packages

  # Enable passwordless sudo
  - usermod -aG sudo ubuntu
  - echo 'ubuntu ALL=(ALL) NOPASSWD:ALL' > /etc/sudoers.d/90-ubuntu
  - chmod 440 /etc/sudoers.d/90-ubuntu

final_message: "ğŸ‰ VM ready!"